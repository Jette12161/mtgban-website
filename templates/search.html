<!DOCTYPE html>
<html>
<head>
    <link href='https://fonts.googleapis.com/css?family=Rosario:400' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="../css/main.css">
    <title>{{.Title}}</title>
    <script type="text/javascript" src="../js/autocomplete.js"></script>
    <script type="text/javascript" src="../js/fetchnames.js"></script>
</head>
<body>

<nav>
    <ul>
        {{range .Nav}}
            <li><a {{if .Active}}class="{{.Class}}"{{end}} href="{{.Link}}">{{.Name}}</a></li>
        {{end}}
    </ul>
</nav>

<div class="mainbody">
    {{if ne .ErrorMessage ""}}
        <h1>{{.ErrorMessage}}</h1>
        {{if .ShowPromo}}
            <img class="center" src="img/promo/search.jpg">
        {{end}}
    {{else}}
        <h1>Welcome to Search</h1>
        <div class="indent sticky" style="top:48px; background-color:#f8f8f8; z-index: 1;">
            <form class="search autocomplete" action="search" autocomplete="off" id="searchform">
                <label style="clear: both; float: left;" for="searchbox">Enter a card name</label>
                {{if ne .Signature ""}}
                    <input type="hidden" name="sig" value="{{.Signature}}">
                {{end}}
                <input id="searchbox" class="w3-input w3-border w3-round-small" onClick="this.setSelectionRange(0, this.value.length)" type="text" name="q" placeholder="Search BAN" value="{{.SearchQuery}}">
            </form>
        </div>

        <script type="text/javascript">
            autocomplete(document.getElementById("searchform"));
        </script>
        {{if eq .SearchQuery ""}}
            <div class="indent">
                <h2>Instructions</h2>
                <ul class="indent">
                    <li>Data is refreshed periodically over the day.</li>
                    <li>You can filter by edition using the Scryfall syntax "s:CODE".</li>
                    <li>The percentage found in buylist offers is the <b>price ratio</b>, the higher it is, the more a vendor is looking to purchase that card.</li>
                    <li>Inventory prices refer to the stated conditions (and their accuracy depends on the data provider).</li>
                    <li>You can filter by condition with "c:COND", accepting NM, SP, MP, HP, and PO.</li>
                    <li>Buylist prices are always referring to NM conditions.</li>
                    <li>In case of mistakes or incongruities, please notify the devs in the BAN Discord.</li>
                    <li>Should you find this content useful, consider clicking on one of the provided links to make a purchase on the website, and directly support BAN.</li>
                </ul>
             </div>
        {{else}}
            <div class="indent sticky" style="top: 120px; z-index: -1;">
                <table style="float: left;">
                    <tr>
                        <td>
                            <img id="cardImage" src="https://img.scryfall.com/errors/missing.jpg" width="354" height="493"/>
                        </td>
                    </tr>
                </table>
            </div>

            <div class="indent">
                <table style="float: left;">
                    <tr>
                        <th colspan="3" class="stickyCategory"><h2 align=center>Sellers</h2></th>
                    </tr>
                    {{if not .FoundSellers}}
                        <tr>
                            <td>No offers available</td>
                        </tr>
                    {{end}}
                    {{range $card, $condsEntry := .FoundSellers}}
                        <tr onmouseover="document.getElementById('cardImage').src={{index $.Images $card}};">
                            <th colspan="3" class="wrap stickyHeader">{{$card.Name}} {{if $card.Foil}}(FOIL){{end}} - {{$card.Edition}} ({{$card.Number}})</th>
                        </tr>
                        {{range $conditions := $.CondKeys}}
                            {{$entries := (index $condsEntry $conditions)}}
                            {{if $entries}}
                                <tr onmouseover="document.getElementById('cardImage').src={{index $.Images $card}};">
                                    <td colspan="3"><i>Conditions: {{$conditions}}</i></th>
                                </tr>
                            {{end}}
                            {{range $entries}}
                                <tr onmouseover="document.getElementById('cardImage').src={{index $.Images $card}};">
                                    <td>
                                        {{if ne .URL ""}}
                                            <a class="btn normal" href="{{.URL}}" target="_blank">
                                                {{.ScraperName}}
                                            </a>
                                        {{else}}
                                            &nbsp;&nbsp;{{.ScraperName}}
                                        {{end}}
                                    </td>
                                    <td>
                                        $ {{.Price}}
                                    </td>
                                    <td>
                                        {{.Quantity}}
                                    </td>
                                </tr>
                            {{end}}
                        {{end}}
                    {{end}}
                </table>

                <table style="float: left;">
                    <tr>
                        <th colspan="4" class="stickyCategory"><h2 align=center>Buyers</h2></th>
                    </tr>
                    {{if not .FoundVendors}}
                        <tr>
                            <td>No offers available</td>
                        </tr>
                    {{end}}
                    {{range $card, $entries := .FoundVendors}}
                        <tr onmouseover="document.getElementById('cardImage').src={{index $.Images $card}};">
                            <th colspan="4" class="wrap stickyHeader">{{$card.Name}} {{if $card.Foil}}(FOIL){{end}} - {{$card.Edition}} ({{$card.Number}})</th>
                        </tr>
                        {{range $entries}}
                            <tr onmouseover="document.getElementById('cardImage').src={{index $.Images $card}};">
                                <td>
                                    {{if ne .URL ""}}
                                        <a class="btn normal" href="{{.URL}}" target="_blank">
                                            {{.ScraperName}}
                                        </a>
                                    {{else}}
                                        &nbsp;&nbsp;{{.ScraperName}}
                                    {{end}}
                                </td>
                                <td>
                                    $ {{.Price}}
                                </td>
                                <td>
                                    {{if ne .Ratio 0.0}}{{printf "%.2f" .Ratio}} %{{end}}
                                </td>
                                <td>
                                    {{if ne .Quantity 0}}{{.Quantity}}{{end}}
                                </td>
                            </tr>
                        {{end}}
                    {{end}}
                </table>
            </div>
        {{end}}
        <br>
        <div class="indent" style="clear:both;">
        Last update: {{.LastUpdate}}
        </div>
    {{end}}
    <br>
</div>
</body>
</html>
